
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Future Designz - Attendance System Pro</title>
    <style>
        :root {
            --primary: #667eea;
            --secondary: #764ba2;
            --success: #28a745;
            --danger: #dc3545;
            --warning: #ffc107;
            --dark: #2d3436;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #f4f7f6; }

        /* --- STICKY TOP NAVIGATION --- */
        .top-nav {
            position: sticky; top: 0; z-index: 1000;
            background: white; padding: 12px 25px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 4px solid var(--secondary);
        }

        /* --- LOGIN OVERLAY --- */
        #loginOverlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            display: flex; justify-content: center; align-items: center; z-index: 10000;
        }
        .login-box { background: white; padding: 40px; border-radius: 15px; text-align: center; width: 90%; max-width: 400px; }
        .login-box input { width: 100%; padding: 12px; margin: 15px 0; border: 1px solid #ddd; border-radius: 8px; }

        /* --- MAIN APP --- */
        .container { padding: 20px; display: none; }
        .logo { width: 120px; height: auto; }
        .btn-group { display: flex; gap: 8px; flex-wrap: wrap; }
        .btn { padding: 10px 15px; border: none; border-radius: 6px; font-weight: 600; cursor: pointer; color: white; display: flex; align-items: center; gap: 5px; font-size: 13px; }
        .btn-primary { background: var(--primary); }
        .btn-success { background: var(--success); }
        .btn-danger { background: var(--danger); }
        .btn-warning { background: var(--warning); color: #333; }
        .btn-dark { background: var(--dark); }

        /* --- TABLE STYLES --- */
        .table-card { background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; }
        .table-wrapper { overflow-x: auto; max-height: 75vh; }
        table { width: 100%; border-collapse: collapse; font-size: 11px; }
        th { background: var(--secondary); color: white; padding: 10px 5px; position: sticky; top: 0; z-index: 20; }
        td { border: 1px solid #eee; text-align: center; height: 95px; min-width: 90px; }
        
        .emp-col { 
            position: sticky; left: 0; background: #fff !important; z-index: 30; 
            width: 160px; font-weight: bold; text-align: left; padding-left: 10px;
            border-right: 3px solid var(--secondary);
        }
        .sunday-col { background-color: #fff0f0 !important; color: red; }

        .status-select { width: 95%; padding: 2px; border-radius: 4px; font-weight: bold; font-size: 10px; border: 1px solid #ccc; }
        .time-input { font-size: 9px; width: 95%; border: 1px solid #eee; margin-top: 1px; padding: 1px; }
        .total-time-display { font-size: 9px; font-weight: bold; color: #764ba2; margin-top: 2px; display: block; }

        #settingsModal {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: white; padding: 25px; border-radius: 12px; z-index: 10001; width: 320px;
            box-shadow: 0 0 50px rgba(0,0,0,0.3);
        }

        /* --- PROFESSIONAL MULTI-PAGE PRINT HANDLING --- */
        @media print {
            @page { size: A4 landscape; margin: 10mm; }
            body { background: white; }
            .top-nav, .btn-group, #loginOverlay, .no-print { display: none !important; }
            .container { display: block !important; width: 100%; padding: 0; margin: 0; }
            .table-card { box-shadow: none; border: none; overflow: visible; }
            .table-wrapper { overflow: visible; max-height: none; }
            
            table { 
                width: 100%; 
                font-size: 9px;
                border: 1px solid #000;
                page-break-inside: auto;
            }
            tr { page-break-inside: avoid; page-break-after: auto; }
            thead { display: table-header-group; } /* Repeats header on every page */
            
            td { height: auto; padding: 4px; border: 1px solid #000 !important; }
            th { border: 1px solid #000 !important; color: black !important; background: #f2f2f2 !important; }
            .emp-col { position: static; border-right: 1px solid #000 !important; background: white !important; }
            .time-input { border: none; }
            .status-select { border: none; appearance: none; -webkit-appearance: none; background: transparent !important; }
        }
    </style>
</head>
<body>

    <div id="loginOverlay">
        <div class="login-box">
            <img src="https://futuredesignz.com/wp-content/uploads/2022/12/future-designs-logo1.webp" class="logo">
            <h2 style="margin: 15px 0;">FD Secure Login</h2>
            <input type="password" id="passInput" placeholder="Password">
            <button class="btn btn-primary" style="width:100%; justify-content:center;" onclick="verifyAccess()">Unlock System</button>
        </div>
    </div>

    <div class="top-nav" id="topNav" style="display:none;">
        <div style="display:flex; align-items:center; gap:15px;">
            <img src="https://futuredesignz.com/wp-content/uploads/2022/12/future-designs-logo1.webp" class="logo">
            <select id="monthSelect" onchange="buildTable()" style="padding:5px; border-radius: 4px;"></select>
            <select id="yearSelect" onchange="buildTable()" style="padding:5px; border-radius: 4px;"></select>
        </div>
        <div class="btn-group">
            <button class="btn btn-primary" onclick="addEmployee()">‚ûï Add User</button>
            <button class="btn btn-danger" onclick="removeEmployee()">‚ûñ Remove User</button>
            <button class="btn btn-dark" onclick="markAllPresent()">‚úÖ All Present</button>
            <button class="btn btn-success" onclick="exportExcelCSV()">üìä Export CSV</button>
            <button class="btn btn-warning" onclick="window.print()">üñ®Ô∏è Print Data</button>
            <button class="btn btn-dark" onclick="toggleSettings()">‚öôÔ∏è Password</button>
            <button class="btn btn-danger" onclick="resetTable()">üóëÔ∏è Reset</button>
        </div>
    </div>

    <div class="container" id="mainApp">
        <div style="display:flex; justify-content:space-between; align-items:baseline; margin-bottom:10px;">
            <h2 style="color:var(--secondary)">Future Designz Attendance Sheet</h2>
            <p><strong>Prepared by:</strong> Hamza Chaudhary</p>
        </div>
        <div class="table-card">
            <div class="table-wrapper">
                <table id="attendanceTable">
                    <thead><tr id="headerRow"></tr></thead>
                    <tbody id="bodyRows"></tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="settingsModal">
        <h3>Update Access</h3><br>
        <p style="font-size: 11px; color: #666; margin-bottom: 5px;">Set your private custom password:</p>
        <input type="text" id="newPass" placeholder="Enter New Password" style="width:100%; padding:8px; margin-bottom:15px; border: 1px solid #ccc; border-radius: 5px;">
        <div class="btn-group" style="justify-content: flex-end;">
            <button class="btn btn-success" onclick="saveNewPassword()">Update</button>
            <button class="btn btn-danger" onclick="toggleSettings()">Close</button>
        </div>
    </div>

    <script>
        // Load employees from local storage or use default list
        let employees = JSON.parse(localStorage.getItem('fd_employees')) || ['Shehroz Sab', 'Uzair Sab', 'Ehsan', 'Waseem Sab', 'Faran Miss', 'Zunaira Miss', 'Sameer', 'Kabeer', 'Adnan Mughal', 'Waris Ali', 'Faroq Sab', 'Haroon Sab', 'Ahmad Cleaner', 'Ameer Hamza', 'Khalil Office boy'];
        
        const masterPass = "Hamza0327@@"; 
        let customPass = localStorage.getItem('custom_fd_pass') || 'fd.7878';

        function verifyAccess() {
            const input = document.getElementById('passInput').value;
            if(input === masterPass || input === customPass) {
                document.getElementById('loginOverlay').style.display = 'none';
                document.getElementById('topNav').style.display = 'flex';
                document.getElementById('mainApp').style.display = 'block';
                initApp();
            } else { alert("Access Denied!"); }
        }

        function addEmployee() {
            let name = prompt("Enter New Employee Name:");
            if (name && name.trim() !== "") {
                employees.push(name.trim());
                saveAndRefresh();
            }
        }

        function removeEmployee() {
            let name = prompt("Enter exact name of employee to remove:");
            const index = employees.indexOf(name);
            if (index > -1) {
                if(confirm(`Are you sure you want to remove ${name}?`)) {
                    employees.splice(index, 1);
                    saveAndRefresh();
                }
            } else {
                alert("Employee name not found. Please type the exact name as shown in the list.");
            }
        }

        function saveAndRefresh() {
            localStorage.setItem('fd_employees', JSON.stringify(employees));
            buildTable();
        }

        function toggleSettings() {
            const modal = document.getElementById('settingsModal');
            modal.style.display = modal.style.display === 'block' ? 'none' : 'block';
        }

        function saveNewPassword() {
            const val = document.getElementById('newPass').value;
            if(val) {
                localStorage.setItem('custom_fd_pass', val);
                customPass = val;
                alert("Password Updated!");
                toggleSettings();
            }
        }

        function initApp() {
            const mSelect = document.getElementById('monthSelect');
            const ySelect = document.getElementById('yearSelect');
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            
            mSelect.innerHTML = "";
            ySelect.innerHTML = "";
            months.forEach((m, i) => mSelect.add(new Option(m, i)));
            for(let y = 2024; y <= 2027; y++) ySelect.add(new Option(y, y));

            const now = new Date();
            mSelect.value = now.getMonth();
            ySelect.value = now.getFullYear();
            buildTable();
        }

        function calculateHours(input) {
            const container = input.parentElement;
            const inTime = container.querySelector('.in-t').value;
            const outTime = container.querySelector('.out-t').value;
            const display = container.querySelector('.total-time-display');

            if (inTime && outTime) {
                const start = new Date(`2000-01-01T${inTime}`);
                const end = new Date(`2000-01-01T${outTime}`);
                let diff = (end - start) / 1000 / 60 / 60; 
                if (diff < 0) diff += 24; 
                display.innerText = diff.toFixed(1) + " hrs";
            } else {
                display.innerText = "0 hrs";
            }
        }

        function buildTable() {
            const month = parseInt(document.getElementById('monthSelect').value);
            const year = parseInt(document.getElementById('yearSelect').value);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let header = '<th class="emp-col">Employee Name</th>';
            for(let d = 1; d <= daysInMonth; d++) {
                const dayName = new Date(year, month, d).toLocaleDateString('en-US', {weekday: 'short'});
                header += `<th class="${dayName === 'Sun' ? 'sunday-col' : ''}">${d}<br>${dayName}</th>`;
            }
            header += '<th>P</th><th>A</th>';
            document.getElementById('headerRow').innerHTML = header;

            const body = document.getElementById('bodyRows');
            body.innerHTML = employees.map((name, idx) => `
                <tr>
                    <td class="emp-col">${name}</td>
                    ${Array.from({length: daysInMonth}, (_, i) => {
                        const isSun = new Date(year, month, i+1).getDay() === 0;
                        return `<td class="${isSun ? 'sunday-col' : ''}">
                            <div class="cell-container">
                                <select class="status-select" onchange="styleCell(this, ${idx})">
                                    <option value="">-</option><option value="P">P</option><option value="A">A</option><option value="L">L</option>
                                </select>
                                <input type="time" class="time-input in-t" onchange="calculateHours(this)">
                                <input type="time" class="time-input out-t" onchange="calculateHours(this)">
                                <span class="total-time-display">0 hrs</span>
                            </div>
                        </td>`;
                    }).join('')}
                    <td id="p-${idx}" style="color:green; font-weight:bold">0</td>
                    <td id="a-${idx}" style="color:red; font-weight:bold">0</td>
                </tr>
            `).join('');
        }

        function styleCell(sel, rowIdx) {
            const colors = { 'P': '#d4edda', 'A': '#f8d7da', 'L': '#fff3cd' };
            sel.style.backgroundColor = colors[sel.value] || 'white';
            
            const row = document.querySelectorAll('#bodyRows tr')[rowIdx];
            const stats = Array.from(row.querySelectorAll('.status-select')).map(s => s.value);
            document.getElementById(`p-${rowIdx}`).innerText = stats.filter(v => v === 'P').length;
            document.getElementById(`a-${rowIdx}`).innerText = stats.filter(v => v === 'A').length;
        }

        function markAllPresent() {
            document.querySelectorAll('.status-select').forEach(s => { s.value = 'P'; s.style.backgroundColor = '#d4edda'; });
            employees.forEach((_, i) => styleCell({value:'P'}, i));
        }

        function resetTable() { if(confirm("Clear current table data?")) buildTable(); }

        function exportExcelCSV() {
            const month = parseInt(document.getElementById('monthSelect').value);
            const year = parseInt(document.getElementById('yearSelect').value);
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            
            let csv = "Employee Name,";
            for(let d = 1; d <= daysInMonth; d++) {
                const dateHeader = `'${year}-${(month+1).toString().padStart(2,'0')}-${d.toString().padStart(2,'0')}`;
                csv += `${dateHeader},`;
            }
            csv += "Total P,Total A\n";

            document.querySelectorAll('#bodyRows tr').forEach((row, i) => {
                const stats = Array.from(row.querySelectorAll('.status-select')).map(s => s.value || "-");
                const p = document.getElementById(`p-${i}`).innerText;
                const a = document.getElementById(`a-${i}`).innerText;
                csv += `"${employees[i]}",${stats.join(",")},${p},${a}\n`;
            });

            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement("a");
            link.href = URL.createObjectURL(blob);
            link.download = `Attendance_${month+1}_${year}.csv`;
            link.click();
        }
    </script>
</body>
</html>
